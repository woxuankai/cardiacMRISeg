% !Mode:: "TeX:UTF-8"

\chapter{多图谱分割方法}

\section{图像配准方法}
  图像配准(image registration)是多图谱分割方法的重中之重，
  图像配准的好坏对最终的分割结果有着直接的影响。

\subsection{图像配准概述}
在医学图像的采集过程中，由于成像原理（MRI, CT, PET, 超声等）、设备、参数的不同，
或者患者同一部位不同时间的形态变化，甚至不同被试者同一部位的结构差别，
会导致成像结果的差异。
而在实际中，将不同的医学图像进行观察，是比较常见的。例如：
\begin{enumerate}
  \item 在数字剪影血管造影(DSA)中，将注射造影剂之前和之后的图像进行相减。
  \item 将患者某一部位的影像和标准影像进行对比。
  \item 将功能成像（例如正电子发射成像，PET）%
    和解剖成像（例如磁共振图像，MRI）综合观察。
\end{enumerate}
如果我们想要综合不同图像进行观察，首先要做的就是将图像``对齐''
，这种所谓的对齐，便是图像配准
\footnote{这里使用了``对齐''这一说法，其实并不准确。
因为``对齐''字面上可能让人误以为只发生平移变换，
而实际上，为了使一幅图像与另一幅图像尽可能吻合，
还需要用到旋转、缩放等等变换。
在实际的配准过程中，这种对齐甚至可以包括仿射变换以及非刚性变换。}。

总的来说，配准，是一个在不同图像之间建立空间上的联系的过程\citeup{MultiAtlasSurvey}，
图\ref{RegistrationIsMapping}形象阐释了这一概念。
\pic[ht]{配准是在图像之间建立空间变换\citeup{itkbook2}}{width=0.6\textwidth}{RegistrationIsMapping}

考虑在两幅图像间配准的情况，
通常一幅图像被称为原图像(source image)或者固定图像(fixed image)，
另一幅图像被称为目标图像(target image)或者浮动图像(moving image)。
用$S$表示固定图像，$T$指代浮动图像，
两幅定义域为$\Omega$的图像通过变换$W$相关联。
配准的目的就是估计出一个最佳的的变换$W$来优化以下这个形式的能量函数
\citeup{DeformableRegistrationSurvey}。
\begin{equation}\label{LossFunction}
\mathcal{M}(T,S\circ W)+\mathcal{R}(W)
\end{equation}
函数由两部分组成，
第一部分刻画了T和用W变换后的S的``对齐''程度，
在这个优化问题中，
需要最大化还是最小化这个能量函数取决于$\mathcal{M}$的定义。
式子的后一项$\mathcal{R}(W)$，
引入了对变换$W$的一个偏好项或者是一个规范项，
可以用于存在对图像变换有一定先验知识的情况，
或者对图像变换的范围有一定规定的情况。

于是，根据\ref{LossFunction}，配准问题转化成为了以下问题
\begin{equation}\label{OptimizationFunction}
  W^\ast=\underset{W}{arg} \ max \ \mathcal{M}(T,S\circ W)+\mathcal{R}(W)
\end{equation}
此处我们假设图像越相似，$\mathcal{M}$越大；
如果图像越相似$\mathcal{M}$越小，
应将式\ref{OptimizationFunction}中$max$变为$min$。


图像配准是医学图像处理分析的基本问题之一，
是该领域的一个热门研究方向。
此外，除了医学图像处理方向，在其它图像处理领域，图像配准也有广泛的应用。

\subsection{配准分类}\label{RegistrationClassification}
\pic[ht]{二维配准的一个例子\citeup{RegistrationSurvey}}{width=0.7\textwidth}{2DTransformation}
根据文献\cite{RegistrationSurvey,RegistrationSurveyNew}，
配准的分类标准有以下几项：
\begin{enumerate}
  \item 图像维度：二维图像配准，三维图像配准等。
  \item 配准特征：
    分为外部特征（例如螺丝钉标或者皮肤上画的标记），
    内部特征（例如图像灰度）和
    非图像特征（例如坐标系统），在\ref{SectionMetric}有更为详细的介绍。
  \item 图像形变模型：图像形变模型是在式子\ref{LossFunction}中将$S$变形，
    使其和$T$相似的变换$W$的数学模型。
    图像形变模型一般分为刚性变换，仿射变换，投影变换和曲线变换，
    在\ref{SectionTransformation}中有更详细的介绍。
  \item 变换域：分为局部变换和全局变换。
    图\ref{2DTransformation}对变换域和图像形变模型有形象的展示。
  \item 交互性：分为交互式，半自动，全自动配准。
  \item 优化过程：分为直接计算变换参数和搜寻最优参数，
    在\ref{SectionOptimization}中有更详细的介绍。
  \item 模态(modality)：一般指的图像采集方式，
    分为多模态（例如CT图像与MRI图像配准），
    单模态（例如CT图像和CT图像配准），对模型配准和对患者配准。
  \item 主体(subject)：分为同一患者的图像相互配准(intrasubject)，
    不同患者的图像之间配准(intersubject)，患者图像与图谱(atlas)。
  \item 对象(object)：被配准的图像中的扫描对象，包括头胸腹肢体等等。
\end{enumerate}

在这篇文章中，我们主要关注的是全自动的单模态心脏图像非刚性配准。

\subsection{形变模型}\label{SectionTransformation}
在式\ref{OptimizationFunction}中，
图像变换$W$和浮动图像$S$、固定图像$T$一起，构成一个配准方法的三大要素。

The optimal choice of algorithm specifics largely depends on the
biomedical application, its goal (Yeo et al., 2010), and operational con-
straints, such as available computational resources, desired accuracy,
and restrictions on time. Once registration is complete, the resulting
spatial transform can then be used to map from the frame of one im-
age to the coordinates of another.
形变模型的选择决定了最终配准效果的上限。
\subsubsection{刚性变换}
\subsubsection{仿射变换}
\subsubsection{非刚性变换}

\subsection{相似性测度}\label{SectionMetric}


\subsection{最优解寻找}\label{SectionOptimization}
最优解的寻找对于一个配准问题来说是至关重要的，
因为如果没有办法求解形变模型的参数，
使用再复杂的形变模型、挑选再适合的相似度测定方法，都是徒劳。
没有办法求解参数，就
在\ref{SectionClassification}所展示的分类中，最优解寻找方法分为直接
对于式\ref{OptimizationFunction}这样一个优化问题，一般很难直接求解$W$，
只能通过一个不断迭代的过程来优化。

一个典型的配准框架如图\ref{RegistrationFramework}所示。
\pic[ht]{一个典型的配准框架\citeup{itkbook2}}{width=0.8\textwidth}{RegistrationFramework}

\subsection{插值方法}\label{SectionModality}

\section{图谱选择方法}

metadata\par

\section{图像融合方法}
\subsection{STAPLE}
\subsection{Jonit Label Fusion}
\subsection{Majority Vote}

\section{分割结果评价}

\section{多图谱方法的未来发展}

\section{本章小结}


\subsection{数值算例与分析}
……。如表\ref{tablea}所示给出了时间步长分别取0.4ns、0.5ns、0.6ns 时的三种存储
方式的存储量大小。……。
\pictable[h]{计算$2m*2m$理想导体平板时域感应电流采用的三种存储方式的存储量比较}{}{tablea}

如图\ref{picd}所示给出了时间步长选取为0.5ns 时采用三种不同存储方式计算的
平板中心处$x$方向的感应电流值与IDFT 方法计算结果的比较，……。如图\ref{pice}
所示给出了存储方式为基权函数压缩存储方式，时间步长分别取0.4ns、0.5ns、0.6ns
时平板中心处$x$方向的感应电流计算结果，从图中可以看出不同时间步长的计算结果基本相同。

\begin{pics}[h]{$2m*2m$的理想导体平板中心处感应电流$x$分量随时间的变化关系}{picde}
\addsubpic{不同存储方式的计算结果与IDFT方法的结果比较}{keepaspectratio,height=5.58cm,width=6.77cm}{picd}
\addsubpic{不同时间步长的计算结果比较}{keepaspectratio=false,height=5.48cm,width=7.04cm}{pice}
\end{pics}
%
由于时域混合场积分方程是时域电场积分方程与时域磁场积分方程的线性组
合，因此时域混合场积分方程时间步进算法的阻抗矩阵特征与时域电场积分方程
时间步进算法的阻抗矩阵特征相同。
\section{时域积分方程时间步进算法矩阵方程的求解}
……

\begin{dingli}
如果时域混合场积分方程是时域电场积分方程与时域磁场积分方程
的线性组合……
\end{dingli}
\begin{zhengming}
首先，由于……

……\\
根据……，结论得证。
\end{zhengming}
\section{本章小结}
本章首先研究了时域积分方程时间步进算法的阻抗元素精确计算技术，分别
采用DUFFY 变换法与卷积积分精度计算法计算时域阻抗元素，通过算例验证了计
算方法的高精度。……
